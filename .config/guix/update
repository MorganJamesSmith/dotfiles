#!/bin/sh

# Update local Emacs source
cd /home/pancake/src/emacs/emacs || exit $?
git stash || exit $?
git rebase --no-gpg-sign || exit $?

# Update local org-mode source
cd /home/pancake/src/emacs/org-mode || exit $?
git stash || exit $?
git rebase --no-gpg-sign || exit $?

# Update local emms source
cd /home/pancake/src/emacs/emms || exit $?
git stash || exit $?
git rebase --no-gpg-sign || exit $?

guix pull || exit $?

# dev environment
rm /home/pancake/.config/guix/dev
guix shell --pure -D guix -D emacs-next-pgtk --root=/home/pancake/.config/guix/dev -- echo "done"

# build manifest
guix build --keep-going -m /home/pancake/.config/guix/default-manifest.scm
guix build --keep-going -m /home/pancake/.config/guix/emacs-manifest.scm

# build system
guix system build --keep-going /home/pancake/.config/guix/config.scm

# build home
guix home build --keep-going /home/pancake/.config/guix/home.scm

# Display news
guix pull --news
