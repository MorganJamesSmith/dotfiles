#!/bin/sh

guix pull || exit $?

# Update local Emacs source
cd /home/pancake/src/emacs/emacs || exit $?
git stash || exit $?
git pull --rebase --no-gpg-sign || exit $?

# Update local org-mode source
cd /home/pancake/src/emacs/org-mode || exit $?
git stash || exit $?
git pull --rebase --no-gpg-sign || exit $?

# build manifest
guix build --keep-going -m /home/pancake/.config/guix/default-manifest.scm
guix build --keep-going -m /home/pancake/.config/guix/emacs-manifest.scm

# build system
guix system build --keep-going /home/pancake/.config/guix/config.scm

# build home
guix home build --keep-going /home/pancake/.config/guix/home.scm

# Display news
guix pull --news
